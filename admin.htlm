/**************************************************************************
 * Panel de administraciÃ³n BINGOÂ JOKER
 * - Protegido por contraseÃ±a (Jrr035$$*)
 * - Extrae bolas, reinicia partidas, muestra ventas
 * - Se comunica con GoogleÂ Sheets vÃ­a api.js
 **************************************************************************/

import { marcarCartonVendido,
         registrarBolaExtraida,
         obtenerDatosIniciales } from './api.js';

let bolasDisponibles = Array.from({ length: 75 }, (_, i) => i + 1);
let bolasExtraidas   = [];
let modoActual       = 'linea';

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACCESO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
export function pedirAccesoAdmin() {
  const clave = prompt('Introduce la contraseÃ±a de administrador:');
  if (clave === 'Jrr035$$*') {
    document.getElementById('panelAdmin').classList.remove('hidden');
    inicializarPanel();
  } else {
    alert('ContraseÃ±a incorrecta.');
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ OPERACIONES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
export async function extraerBola() {
  if (bolasDisponibles.length === 0) {
    alert('Ya se han extraÃ­do todas las bolas.');
    return;
  }
  const i   = Math.floor(Math.random() * bolasDisponibles.length);
  const bola = bolasDisponibles.splice(i, 1)[0];
  bolasExtraidas.push(bola);

  mostrarBola(bola);                 // animaciÃ³n en pantalla
  await registrarBolaExtraida(bola); // guardar en Sheets
}

export function reiniciarPartida() {
  if (!confirm('Â¿Reiniciar la partida?')) return;
  bolasDisponibles = Array.from({ length: 75 }, (_, i) => i + 1);
  bolasExtraidas   = [];
  document.getElementById('bolaActual')?.remove();
  console.log('ðŸŽ² Partida reiniciada');
}

function cambiarModo(e) { modoActual = e.target.value; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UI / RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function mostrarBola(num) {
  const old = document.getElementById('bolaActual');
  if (old) old.remove();

  const div = document.createElement('div');
  div.id        = 'bolaActual';
  div.className = 'bola my-4';
  div.textContent = num;
  document.body.appendChild(div);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ INICIALIZAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function inicializarPanel() {
  const datos  = await obtenerDatosIniciales();          // { ventas, bolas, â€¦ }
  const ventas = datos.ventas || [];
  document.getElementById('infoVentas').textContent =
        `${ventas.length} cartones vendidos`;

  // Si tu API devuelve bolas previas, podrÃ­as restaurarlas aquÃ­
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ EVENTOS DOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('btnExtraer') .addEventListener('click', extraerBola);
document.getElementById('btnReiniciar').addEventListener('click', reiniciarPartida);
document.getElementById('modoJuego')  .addEventListener('change', cambiarModo);
